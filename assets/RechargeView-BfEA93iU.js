import{d as X,r as d,Q as J,a0 as ee,m as ae,a as U,e as a,f as o,z as te,a1 as le,F as D,R as oe,S as ne,T as re,a2 as se,b as f,C as ue,q as de,u as r,i as M,H as ie,G as w,U as me,V as pe,W as ce,y as _e,X as fe,j as y,n as ge,t as ve,x as we,Y as Ve,Z as be,K as ye,a3 as he,p as ke,M as Ee,a4 as Ie,$ as Ue,o as _,_ as De}from"./index-C6CTqLNF.js";/* empty css                      */import{P as T}from"./el-select-HlkMswhJ.js";import{u as Te,_ as Se}from"./CardListDrawer.vue_vue_type_style_index_0_lang-Dlbe_o6v.js";/* empty css                                                   */const Ce={class:"page-header"},xe={class:"page-header__actions"},Pe={class:"page-header__actions"},Re={class:"drawer-info"},Fe={class:"drawer-footer"},Ae=X({__name:"RechargeView",setup(Me){const L=[{text:"过去一周",value:()=>{const l=new Date,e=new Date;return e.setTime(e.getTime()-6048e5),[e,l]}},{text:"过去一个月",value:()=>{const l=new Date,e=new Date;return e.setTime(e.getTime()-2592e6),[e,l]}},{text:"过去三个月",value:()=>{const l=new Date,e=new Date;return e.setTime(e.getTime()-7776e6),[e,l]}}],S=new Map,h=d([]),N=Te(),{currentPage:V,searchForm:u,ruleForm:n}=J(N),Y=d(),C=d(0),x=d([]),k=d(!1),g=d(!1),P=d(""),E=d(),I=d(!1),R=d([]),$=ee({times:[{required:!0,message:"请输入充值次数",trigger:"blur"}],amount:[{validator:(l,e,s)=>{e===""||/^-?\d+(\.\d{1,2})?$/.test(e)?s():s(new Error("请输入正确的金额格式: 0.00"))},trigger:"blur"}]}),b=async()=>{k.value=!0;const l=new URLSearchParams({skip:String((V.value-1)*T),limit:String(T)});u.value.datarange&&(l.append("start",String(u.value.datarange[0])),l.append("end",String(u.value.datarange[1]))),n.value.userId&&l.append("user",n.value.userId),u.value.category&&l.append("category",u.value.category);const e=await oe(l),{data:s}=e;x.value=s.list.map(m=>{const i=m;return{...i,createdAt:re(i.createdAt).format("YYYY-MM-DD HH:mm:ss"),username:S.get(i.userId),category:i.category==="recharge"?"充值":"消费",amount:ne.fenToYuan(i.amount)}}),C.value=s.count,k.value=!1},B=()=>{var l;if(!n.value.userId){Ee({message:"请先选择用户",type:"warning",position:"top-left"});return}P.value="新增记录",(l=E.value)==null||l.clearValidate(),n.value._id="",n.value.category="recharge",n.value.times=0,n.value.amount="0.00",n.value.description="",g.value=!0},z=l=>{l&&l.validate(async e=>{e&&await Ie(n.value)&&(b(),g.value=!1)})},G=async l=>{console.log("查看名单",l),Ue(l).then(e=>{if(e){console.log(e);const{data:s}=e;R.value=s.cards,I.value=!0}})},H=async()=>{const l=new URLSearchParams({skip:"0",limit:"0",deprecated:"false"}),e=await se(l),{data:s}=e;return s.list};return ae(async()=>{const l=await H();l.forEach(e=>{S.set(e._id,e.username)}),h.value=l,b()}),(l,e)=>{const s=ye,m=_e,i=de,v=ie,j=ce,p=pe,F=me,c=ge,q=we,O=Ve,Z=te,K=he,A=ke,Q=le,W=fe;return _(),U(D,null,[a(Z,null,{aside:o(()=>[a(s)]),default:o(()=>[f("div",Ce,[e[13]||(e[13]=f("h1",null,"账单管理",-1)),f("div",xe,[a(i,{clearable:"",modelValue:r(n).userId,"onUpdate:modelValue":e[0]||(e[0]=t=>r(n).userId=t),placeholder:"用户名",class:"user-select"},{default:o(()=>[(_(!0),U(D,null,M(h.value,t=>(_(),y(m,{key:t._id,label:t.username,value:t._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(v,{type:"primary",onClick:B},{default:o(()=>e[12]||(e[12]=[w("新增记录")])),_:1})])]),f("div",Pe,[a(F,{ref_key:"searchFormRef",ref:Y,inline:!0,model:r(u),class:"search-form-inline"},{default:o(()=>[a(p,{prop:"datarange"},{default:o(()=>[a(j,{modelValue:r(u).datarange,"onUpdate:modelValue":e[1]||(e[1]=t=>r(u).datarange=t),type:"daterange","unlink-panels":"","range-separator":"To","start-placeholder":"Start date","end-placeholder":"End date",shortcuts:L,"value-format":"x"},null,8,["modelValue"])]),_:1}),a(p,{prop:"category"},{default:o(()=>[a(i,{clearable:"",modelValue:r(u).category,"onUpdate:modelValue":e[2]||(e[2]=t=>r(u).category=t),placeholder:"类别",class:"category-select"},{default:o(()=>[a(m,{label:"充值",value:"recharge"}),a(m,{label:"消费",value:"deduct"})]),_:1},8,["modelValue"])]),_:1}),a(p,null,{default:o(()=>[a(v,{onClick:b},{default:o(()=>e[14]||(e[14]=[w("查询")])),_:1})]),_:1})]),_:1},8,["model"])]),ue((_(),y(q,{data:x.value,style:{width:"100%"}},{default:o(()=>[a(c,{prop:"createdAt",label:"创建时间",width:"180"}),a(c,{prop:"username",label:"用户名",width:"120"}),a(c,{prop:"category",label:"类别",width:"180"}),a(c,{prop:"times",label:"次数",width:"180"}),a(c,{prop:"amount",label:"金额(元)",width:"180"}),a(c,{prop:"description",label:"备注",width:"180"}),a(c,{label:"操作",width:"180"},{default:o(t=>[t.row.category==="消费"?(_(),y(v,{key:0,onClick:Ne=>G(t.row._id)},{default:o(()=>e[15]||(e[15]=[w("查看名单")])),_:2},1032,["onClick"])):ve("",!0)]),_:1})]),_:1},8,["data"])),[[W,k.value]]),a(O,{"current-page":r(V),"onUpdate:currentPage":e[3]||(e[3]=t=>be(V)?V.value=t:null),"page-size":r(T),total:C.value,"hide-on-single-page":!0,layout:"prev, pager, next",onChange:b},null,8,["current-page","page-size","total"])]),_:1}),a(Q,{modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=t=>g.value=t),title:P.value,size:"50%"},{default:o(()=>[f("div",Re,[a(F,{model:r(n),ref_key:"ruleFormRef",ref:E,rules:$,"label-width":"100px"},{default:o(()=>[a(p,{label:"用户名",prop:"userId"},{default:o(()=>[a(i,{modelValue:r(n).userId,"onUpdate:modelValue":e[4]||(e[4]=t=>r(n).userId=t),disabled:""},{default:o(()=>[(_(!0),U(D,null,M(h.value,t=>(_(),y(m,{key:t._id,label:t.username,value:t._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"充值次数",prop:"times"},{default:o(()=>[a(K,{modelValue:r(n).times,"onUpdate:modelValue":e[5]||(e[5]=t=>r(n).times=t)},null,8,["modelValue"])]),_:1}),a(p,{label:"充值金额(元)",prop:"amount"},{default:o(()=>[a(A,{modelValue:r(n).amount,"onUpdate:modelValue":e[6]||(e[6]=t=>r(n).amount=t)},null,8,["modelValue"])]),_:1}),a(p,{label:"描述",prop:"description"},{default:o(()=>[a(A,{modelValue:r(n).description,"onUpdate:modelValue":e[7]||(e[7]=t=>r(n).description=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),f("div",Fe,[a(v,{onClick:e[8]||(e[8]=t=>g.value=!1)},{default:o(()=>e[16]||(e[16]=[w("取 消")])),_:1}),a(v,{type:"primary",onClick:e[9]||(e[9]=t=>z(E.value))},{default:o(()=>e[17]||(e[17]=[w("提交")])),_:1})])])]),_:1},8,["modelValue","title"]),a(Se,{modelValue:I.value,"onUpdate:modelValue":e[11]||(e[11]=t=>I.value=t),"table-data":R.value},null,8,["modelValue","table-data"])],64)}}}),He=De(Ae,[["__scopeId","data-v-2e6a74a7"]]);export{He as default};
