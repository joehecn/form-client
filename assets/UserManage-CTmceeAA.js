import{a5 as h,r as i,d as j,Q as H,a0 as z,m as J,a as K,e as a,f as r,z as O,a1 as Q,F as W,a2 as X,b as g,C as Y,U as ee,u as p,V as ae,p as le,q as te,y as re,H as oe,G as m,X as se,j as de,n as ne,J as A,x as ue,Y as ie,Z as pe,K as me,a8 as fe,a9 as _e,aa as ce,o as D,_ as ve}from"./index-C6CTqLNF.js";/* empty css                      */import{P as y}from"./el-select-HlkMswhJ.js";const we=h("user",()=>{const C=i(1),E=i({username:void 0,deprecated:void 0});return{currentPage:C,searchForm:E}}),ge={class:"page-header"},Ve={class:"page-header__actions"},be={class:"drawer-info"},Pe={class:"dialog-footer"},Ee=j({__name:"UserManage",setup(C){const E=we(),{currentPage:V,searchForm:d}=H(E),q=i(),F=i(0),S=i([]),U=i(!1),f=i(!1),n=i(""),c=i(),B=z({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]{6,10}$/,message:"6到10个字母数字下划线",trigger:"blur"}],password:[{validator:(s,e,o)=>{e===""?n.value==="更新用户"?o():o(new Error("请输入密码")):l.role==="admin"?o(new Error("不能重置管理员密码")):/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d\W_]{8,}$/.test(e)?(c.value.validateField("rePassword"),o()):o(new Error("至少8个字符, 必须包含大写字母, 小写字母, 数字"))},trigger:"blur"}],rePassword:[{validator:(s,e,o)=>{e===""?n.value==="更新用户"?o():o(new Error("请再次输入密码")):e!==l.password?o(new Error("两次输入不一致!")):o()},trigger:"blur"}],deprecated:[{validator:(s,e,o)=>{e&&l.role==="admin"?o(new Error("不能禁用管理员")):o()},trigger:"change"}]}),l=z({_id:"",username:"",role:"customer",password:"",rePassword:"",description:"",deprecated:!1}),b=async()=>{U.value=!0;const s=new URLSearchParams({skip:String((V.value-1)*y),limit:String(y)});d.value.username&&s.append("username",d.value.username),d.value.deprecated!==void 0&&s.append("deprecated",String(d.value.deprecated));const e=await X(s),{data:o}=e;S.value=o.list,F.value=o.count,U.value=!1},I=()=>{var s;n.value="新增用户",(s=c.value)==null||s.clearValidate(),l.username="",l.role="customer",l.password="",l.rePassword="",l.description="",l.deprecated=!1,f.value=!0},M=async s=>{var e;n.value="更新用户",f.value=!0,(e=c.value)==null||e.clearValidate(),l._id=s._id,l.username=s.username,l.role=s.role,l.password="",l.rePassword="",l.description=s.description,l.deprecated=s.deprecated},T=s=>{s&&s.validate(async e=>{if(e){let o=null;n.value==="新增用户"?o=await _e(l):o=await ce(l._id,l),o&&(b(),f.value=!1)}})};return J(()=>{b()}),(s,e)=>{const o=me,_=le,u=ae,P=re,x=te,v=oe,R=ee,w=ne,Z=ue,$=ie,k=O,L=fe,N=Q,G=se;return D(),K(W,null,[a(k,null,{aside:r(()=>[a(o)]),default:r(()=>[g("div",ge,[e[14]||(e[14]=g("h1",null,"用户管理",-1)),g("div",Ve,[a(R,{ref_key:"searchFormRef",ref:q,inline:!0,model:p(d),class:"search-form-inline"},{default:r(()=>[a(u,{prop:"username"},{default:r(()=>[a(_,{clearable:"",modelValue:p(d).username,"onUpdate:modelValue":e[0]||(e[0]=t=>p(d).username=t),placeholder:"用户名"},null,8,["modelValue"])]),_:1}),a(u,{prop:"deprecated"},{default:r(()=>[a(x,{clearable:"",modelValue:p(d).deprecated,"onUpdate:modelValue":e[1]||(e[1]=t=>p(d).deprecated=t),placeholder:"全部状态"},{default:r(()=>[a(P,{label:"禁用状态",value:!0}),a(P,{label:"正常状态",value:!1})]),_:1},8,["modelValue"])]),_:1}),a(u,null,{default:r(()=>[a(v,{onClick:b},{default:r(()=>e[12]||(e[12]=[m("查询")])),_:1})]),_:1})]),_:1},8,["model"]),a(v,{class:"add-user-btn",type:"primary",onClick:I},{default:r(()=>e[13]||(e[13]=[m("新增用户")])),_:1})])]),Y((D(),de(Z,{data:S.value,style:{width:"100%"}},{default:r(()=>[a(w,{prop:"username",label:"用户名"}),a(w,{prop:"role",label:"角色"},{default:r(({row:t})=>[m(A(t.role==="admin"?"管理员":"客户"),1)]),_:1}),a(w,{prop:"description",label:"备注"}),a(w,{prop:"deprecated",label:"状态"},{default:r(({row:t})=>[m(A(t.deprecated?"禁用":""),1)]),_:1}),a(w,{label:"操作",width:"68"},{default:r(t=>[a(v,{type:"primary",plain:"",onClick:Fe=>M(t.row)},{default:r(()=>e[15]||(e[15]=[m("更新")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,U.value]]),a($,{"current-page":p(V),"onUpdate:currentPage":e[2]||(e[2]=t=>pe(V)?V.value=t:null),"page-size":p(y),total:F.value,"hide-on-single-page":!0,layout:"prev, pager, next",onChange:b},null,8,["current-page","page-size","total"])]),_:1}),a(N,{modelValue:f.value,"onUpdate:modelValue":e[11]||(e[11]=t=>f.value=t),title:n.value,size:"50%"},{footer:r(()=>[g("span",Pe,[a(v,{onClick:e[9]||(e[9]=t=>f.value=!1)},{default:r(()=>e[16]||(e[16]=[m("取 消")])),_:1}),a(v,{type:"primary",onClick:e[10]||(e[10]=t=>T(c.value))},{default:r(()=>e[17]||(e[17]=[m("确 定")])),_:1})])]),default:r(()=>[g("div",be,[a(R,{ref_key:"ruleFormRef",ref:c,model:l,rules:B,"label-width":"80px"},{default:r(()=>[a(u,{label:"用户名",prop:"username"},{default:r(()=>[a(_,{modelValue:l.username,"onUpdate:modelValue":e[3]||(e[3]=t=>l.username=t),placeholder:"6到10个字母数字下划线",disabled:n.value==="更新用户"},null,8,["modelValue","disabled"])]),_:1}),a(u,{label:"角色",prop:"role"},{default:r(()=>[a(x,{modelValue:l.role,"onUpdate:modelValue":e[4]||(e[4]=t=>l.role=t),placeholder:"请选择角色",disabled:""},{default:r(()=>[a(P,{label:"管理员",value:"admin"}),a(P,{label:"客户",value:"customer"})]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"密码",prop:"password",required:n.value==="新增用户"},{default:r(()=>[a(_,{modelValue:l.password,"onUpdate:modelValue":e[5]||(e[5]=t=>l.password=t),type:"password",placeholder:"至少8个字符, 必须包含大写字母, 小写字母, 数字",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["required"]),a(u,{label:"确认密码",prop:"rePassword",required:n.value==="新增用户"},{default:r(()=>[a(_,{modelValue:l.rePassword,"onUpdate:modelValue":e[6]||(e[6]=t=>l.rePassword=t),type:"password",placeholder:"请再次输入密码",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["required"]),a(u,{label:"备注",prop:"description"},{default:r(()=>[a(_,{modelValue:l.description,"onUpdate:modelValue":e[7]||(e[7]=t=>l.description=t),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),a(u,{label:"状态",prop:"deprecated"},{default:r(()=>[a(L,{modelValue:l.deprecated,"onUpdate:modelValue":e[8]||(e[8]=t=>l.deprecated=t),"inline-prompt":"","active-text":"禁用","inactive-text":"正常"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","title"])],64)}}}),ze=ve(Ee,[["__scopeId","data-v-2aeba7c5"]]);export{ze as default};
